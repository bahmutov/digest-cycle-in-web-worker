<!DOCTYPE html>
<html lang="en">

<head>
  <title>Digest in web worker</title>
  <style>
  p {
    padding: 10px;
  }
  </style>
  <script src="micro-angular.js"></script>
  <script src="primes.js"></script>
</head>

<body>
  <h1>Digest in web worker</h1>
  <p>Open browser console to see log messages.</p>
  <div id="primes"></div>
  <script>
    var scope = new Scope();
    scope.$watch(function watcherFn(scope) {
      return scope.n;
    }, function listenerFn(newValue, oldValue, scope) {
      if (newValue) {
        console.log('finding', newValue, 'primes');
        scope.primes = findPrimes(newValue);
      }
    });
    scope.n = 5000;
    console.profile('finding primes');
    scope.$digest(function afterDigest(scope) {
      var n = scope.n;
      var str = '<ul>';
      for (k = 0; k < n; k += 1) {
        str += '<li>' + (k + 1) + ' prime ' + scope.primes[k] + '</li>';
      }
      str += '</ul>';
      document.getElementById('primes').innerHTML = str + str + str + str + str;
      setTimeout(function () {
        console.profileEnd('finding primes');
      }, 0);
    });
  </script>
</body>
</html>
